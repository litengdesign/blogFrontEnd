<app-search (add)="showModal()"></app-search>
<nz-table #basicTable [nzData]="displayData" nzBordered nzSize="middle">
  <thead>
    <tr>
      <th>产品名称</th>
      <th>产品分类</th>
      <th>所属品牌</th>
      <th>月租金</th>
      <th>发布状态</th>
      <th>创建时间</th>
      <th>相关操作</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of basicTable.data">
      <td>{{ item.name }}</td>
      <td>{{ item.category.label }}</td>
      <td>{{ item.brand.label }}</td>
      <td>{{item.priceMonth}}</td>
      <td>{{ item.status }}</td>
      <td>{{ item.createTime | date : 'yyyy-MM-dd HH:mm'}}</td>
      <td>
        <app-premission (update)="editRow(item)" (delete)="deleteRow(item)"></app-premission>
      </td>
    </tr>
  </tbody>
</nz-table>

<!-- 编辑框 -->
<nz-modal [nzWidth]="960" [(nzVisible)]="isVisible" nzTitle="{{modalTitle}}" nzOkText="确定" nzCancelText="取消"
  (nzOnOk)="handleOk()" (nzOnCancel)="handleCancel()" [nzFooter]="modalFooter" [nzStyle]="{ top: '20px' }">
  <form nz-form [formGroup]="validateForm" #myForm="ngForm" >
    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzRequired>产品标题</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input formControlName="name" placeholder="请输入" type="text">
        <nz-form-explain *ngIf="validateForm.get('name').dirty">
          <ng-container *ngIf="validateForm.get('name').hasError('required')">
            产品标题不能为空！
          </ng-container>
        </nz-form-explain>
      </nz-form-control>
      <nz-form-label [nzSpan]="4" nzRequired>产品型号</nz-form-label>
      <nz-form-control [nzSpan]="4">
        <input nz-input formControlName="code" placeholder="请输入" type="text">
        <nz-form-explain *ngIf="validateForm.get('code').dirty">
          <ng-container *ngIf="validateForm.get('code').hasError('required')">
            产品型号不能为空！
          </ng-container>
        </nz-form-explain>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzRequired>月租金</nz-form-label>
      <nz-form-control [nzSpan]="4">
        <input nz-input formControlName="priceMonth" placeholder="请输入" type="number" min=1>
      </nz-form-control>
      <nz-form-label [nzSpan]="4" nzRequired>产品分类</nz-form-label>
      <nz-form-control [nzSpan]="4">
        <nz-select nzPlaceHolder="请选择" formControlName="category">
          <nz-option *ngFor="let p of categorys" [nzValue]="p" [nzLabel]="p.label"></nz-option>
        </nz-select>
      </nz-form-control>
      <nz-form-label [nzSpan]="4" nzRequired>所属品牌</nz-form-label>
      <nz-form-control [nzSpan]="4">
        <nz-select nzPlaceHolder="请选择" formControlName="brand">
          <nz-option *ngFor="let p of brands" [nzValue]="p" [nzLabel]="p.label"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzRequired>保底消费</nz-form-label>
      <nz-form-control [nzSpan]="20">
        <input nz-input formControlName="minShopping" placeholder="请输入" type="text">
      </nz-form-control>
      <nz-form-explain *ngIf="validateForm.get('minShopping').dirty">
        <ng-container *ngIf="validateForm.get('minShopping').hasError('required')">
          保底消费不能为空！
        </ng-container>
      </nz-form-explain>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzRequired>使用消费</nz-form-label>
      <nz-form-control [nzSpan]="20">
        <input nz-input formControlName="useShopping" placeholder="请输入" type="text">
      </nz-form-control>
      <nz-form-explain *ngIf="validateForm.get('useShopping').dirty">
        <ng-container *ngIf="validateForm.get('useShopping').hasError('required')">
          使用消费不能为空！
        </ng-container>
      </nz-form-explain>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4" nzRequired>合同期</nz-form-label>
      <nz-form-control [nzSpan]="20">
        <input nz-input formControlName="contract" placeholder="请输入" type="text">
      </nz-form-control>
      <nz-form-explain *ngIf="validateForm.get('contract').dirty">
        <ng-container *ngIf="validateForm.get('contract').hasError('required')">
          使用消费不能为空！
        </ng-container>
      </nz-form-explain>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4">产品描述</nz-form-label>
      <nz-form-control [nzSpan]="20">
        <textarea nz-input rows="3" formControlName="description" placeholder="请输入" type="text"></textarea>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4">产品缩略图</nz-form-label>
      <nz-form-control [nzSpan]="20">
        <nz-upload nzAction="{{api_upload}}" nzListType="picture-card" nzName="upload" [(nzFileList)]="fileList"
          [nzShowButton]="fileList.length < 10" [nzPreview]="handlePreview" [nzMultiple]="true">
          <i nz-icon type="plus"></i>
          <div class="ant-upload-text">上传</div>
        </nz-upload>
        <nz-modal [nzVisible]="previewVisible" [nzContent]="modalContent" [nzFooter]="null"
          (nzOnCancel)="previewVisible=false">
          <ng-template #modalContent>
            <img [src]="previewImage" [ngStyle]="{ 'width': '100%' }" />
          </ng-template>
        </nz-modal>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4">详细内容</nz-form-label>
      <nz-form-control [nzSpan]="20">
        <form #myForm="ngForm">
          <div class="form-group has-feedback" [ngClass]="{ 'has-error': myckeditor.invalid && myckeditor.touched }">
            <ckeditor [(ngModel)]="mycontent" #myckeditor="ngModel" name="myckeditor" required [config]="ckeConfig"
              debounce="700">
            </ckeditor>
          </div>
        </form>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label [nzSpan]="4">是否启用</nz-form-label>
      <nz-form-control [nzSpan]="1">
        <nz-switch nzSize="small" formControlName="status"></nz-switch>
      </nz-form-control>
      <nz-form-label [nzSpan]="4">是否推荐</nz-form-label>
      <nz-form-control [nzSpan]="1">
        <nz-switch nzSize="small" formControlName="isTop"></nz-switch>
      </nz-form-control>
    </nz-form-item>
  </form>
  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="resetForm()">重置</button>
    <button nz-button nzType="primary" [disabled]="!validateForm.valid"
      (click)="submitForm(validateForm.value)">保存</button>
  </ng-template>
</nz-modal>